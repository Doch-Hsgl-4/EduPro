–§–∞–π–ª: academy.sql
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\academy.sql
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
-- phpMyAdmin SQL Dump
-- version 5.2.2
-- https://www.phpmyadmin.net/
--
-- –•–æ—Å—Ç: db
-- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è: –°–µ–Ω 26 2025 –≥., 16:29
-- –í–µ—Ä—Å–∏—è —Å–µ—Ä–≤–µ—Ä–∞: 8.0.43
-- –í–µ—Ä—Å–∏—è PHP: 8.2.27

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `academy`
--

-- --------------------------------------------------------

--
-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `registration_attempts`
--

CREATE TABLE `registration_attempts` (
  `id` int NOT NULL,
  `ip_hash` char(64) NOT NULL,
  `email_hash` char(64) NOT NULL,
  `success` tinyint(1) NOT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

-- --------------------------------------------------------

--
-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `users`
--

CREATE TABLE `users` (
  `id` int NOT NULL,
  `username` varchar(30) NOT NULL,
  `email` varchar(254) NOT NULL,
  `password_hash` varchar(255) NOT NULL,
  `role` enum('student','admin') DEFAULT 'student',
  `email_confirmed` tinyint(1) DEFAULT '0',
  `confirm_token` varchar(64) DEFAULT NULL,
  `confirm_sent_at` datetime DEFAULT NULL,
  `session_token` varchar(64) DEFAULT NULL,
  `created_at` timestamp NULL DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

--
-- –ò–Ω–¥–µ–∫—Å—ã —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
--

--
-- –ò–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã `registration_attempts`
--
ALTER TABLE `registration_attempts`
  ADD PRIMARY KEY (`id`);

--
-- –ò–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü—ã `users`
--
ALTER TABLE `users`
  ADD PRIMARY KEY (`id`),
  ADD UNIQUE KEY `username` (`username`),
  ADD UNIQUE KEY `email` (`email`);

--
-- AUTO_INCREMENT –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
--

--
-- AUTO_INCREMENT –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `registration_attempts`
--
ALTER TABLE `registration_attempts`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;

--
-- AUTO_INCREMENT –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `users`
--
ALTER TABLE `users`
  MODIFY `id` int NOT NULL AUTO_INCREMENT;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;

--------------------------------------------------------------------------------

–§–∞–π–ª: docker-compose.yml
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\docker-compose.yml
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
services:
  app:
    build: ./php
    container_name: academy_app
    volumes:
      - ./frontend:/var/www/html
      - ./backend:/var/www/html/backend
    ports:
      - "8080:80"
    depends_on:
      - db
    restart: always

  db:
    image: mysql:8.0
    container_name: academy_db
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: academy
      MYSQL_USER: academy_user
      MYSQL_PASSWORD: userpass
    # ports:
    #   - "3306:3306"
    volumes:
      - db_data:/var/lib/mysql
    restart: always

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    container_name: academy_phpmyadmin
    environment:
      PMA_HOST: db
      PMA_USER: root
      PMA_PASSWORD: rootpass
    ports:
      - "8081:80"
    depends_on:
      - db
    restart: always

volumes:
  db_data:

--------------------------------------------------------------------------------

–§–∞–π–ª: README.md
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\README.md
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# EduPro
Academy

--------------------------------------------------------------------------------

–§–∞–π–ª: scan.py
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\scan.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
import os

def scan_and_save():
    output_file = "scan_result.txt"

    # –ø–∞–ø–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    ignore_dirs = {".git", "__pycache__", ".idea", ".vscode", "node_modules"}
    # —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    ignore_ext = {
        ".png", ".jpg", ".jpeg", ".gif", ".bmp",
        ".ico", ".exe", ".dll", ".so", ".bin",
        ".pack", ".idx", ".sample"
    }

    with open(output_file, "w", encoding="utf-8") as out:
        for root, dirs, files in os.walk(os.getcwd()):
            # —Ñ–∏–ª—å—Ç—Ä—É–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            dirs[:] = [d for d in dirs if d not in ignore_dirs]

            for file in files:
                filepath = os.path.join(root, file)

                # –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
                if any(file.lower().endswith(ext) for ext in ignore_ext):
                    continue

                # –Ω–µ –≤–∫–ª—é—á–∞–µ–º —Å–∞–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if file == output_file:
                    continue

                out.write(f"–§–∞–π–ª: {file}\n")
                out.write(f"–ü—É—Ç—å: {filepath}\n")
                out.write("–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:\n")

                try:
                    with open(filepath, "r", encoding="utf-8", errors="ignore") as f:
                        out.write(f.read())
                except Exception as e:
                    out.write(f"[–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è: {e}]")

                out.write("\n" + "-" * 80 + "\n\n")

    print(f"–ì–æ—Ç–æ–≤–æ. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {output_file}")

if __name__ == "__main__":
    scan_and_save()

--------------------------------------------------------------------------------

–§–∞–π–ª: check_confirm_status.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\backend\check_confirm_status.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /backend/check_confirm_status.php
declare(strict_types=1);

ini_set('display_errors', '1');
error_reporting(E_ALL);


header("Content-Type: application/json; charset=UTF-8");

require_once __DIR__ . "/../db.php";

// –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF
$input = json_decode(file_get_contents("php://input"), true);
if (!isset($input['csrf'], $_COOKIE['csrf_token']) || $input['csrf'] !== $_COOKIE['csrf_token']) {
    echo json_encode(['confirmed' => false, 'error' => 'CSRF check failed'], JSON_UNESCAPED_UNICODE);
    exit;
}

if (empty($_COOKIE['session_token'])) {
    echo json_encode(['confirmed' => false, 'error' => '–ù–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏'], JSON_UNESCAPED_UNICODE);
    exit;
}

$stmt = $pdo->prepare("SELECT email_confirmed FROM users WHERE session_token = ?");
$stmt->execute([$_COOKIE['session_token']]);
$confirmed = (bool)$stmt->fetchColumn();

echo json_encode(['confirmed' => $confirmed], JSON_UNESCAPED_UNICODE);

--------------------------------------------------------------------------------

–§–∞–π–ª: cleanup_inactive.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\backend\cleanup_inactive.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /backend/cleanup_inactive.php
require_once __DIR__ . "/../db.php";

$stmt = $pdo->prepare("DELETE FROM users WHERE email_confirmed = 0 AND confirm_sent_at < (NOW() - INTERVAL 1 DAY)");
$stmt->execute();

--------------------------------------------------------------------------------

–§–∞–π–ª: confirm_email.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\backend\confirm_email.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /backend/confirm_email.php
require_once __DIR__ . "/../db.php";

if (!isset($_GET['token'])) {
    die("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞.");
}

$token = $_GET['token'];

// –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—á—Ç—ã
$stmt = $pdo->prepare("SELECT id FROM users WHERE confirm_token = ?");
$stmt->execute([$token]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);

if (!$user) {
    die("–¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω.");
}

$stmt = $pdo->prepare("UPDATE users SET email_confirmed = 1, confirm_token = NULL WHERE id = ?");
$stmt->execute([$user['id']]);

echo "<h2>‚úÖ –ü–æ—á—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!</h2><p>–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ <a href='/ru/map.php'>–∫–∞—Ä—Ç—É</a>.</p>";

--------------------------------------------------------------------------------

–§–∞–π–ª: db.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\backend\db.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// db.php ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MySQL

$host = 'db'; // –∏–º—è —Å–µ—Ä–≤–∏—Å–∞ –∏–∑ docker-compose, –∞ –Ω–µ localhost
$dbname = 'academy';
$username = 'academy_user';
$password = 'userpass';

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ PDO
$dsn = "mysql:host=$host;dbname=$dbname;charset=utf8mb4";

try {
    $pdo = new PDO($dsn, $username, $password, [
        PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION, // –æ—à–∏–±–∫–∏ –≤ –≤–∏–¥–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC, // –∞—Å—Å–æ—Ü–∏–∞—Ç–∏–≤–Ω—ã–π –º–∞—Å—Å–∏–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        PDO::ATTR_EMULATE_PREPARES => false, // –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Ç–∏–≤–Ω—ã—Ö prepared statements
    ]);
} catch (PDOException $e) {
    // –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
    http_response_code(500);
    echo "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö: " . $e->getMessage();
    exit;
}
?>
--------------------------------------------------------------------------------

–§–∞–π–ª: register.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\backend\register.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /backend/register.php
declare(strict_types=1);
header('Content-Type: application/json; charset=utf-8');

// Security headers
header("X-Content-Type-Options: nosniff");
header("X-Frame-Options: SAMEORIGIN");
header("Referrer-Policy: strict-origin-when-cross-origin");
header("Content-Security-Policy: default-src 'none'; frame-ancestors 'self'; base-uri 'self'; form-action 'self';");

// –†–∞–∑—Ä–µ—à–∏–º —Ç–æ–ª—å–∫–æ POST JSON
if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
    http_response_code(405);
    echo json_encode(['ok' => false, 'errors' => ['common' => '–ú–µ—Ç–æ–¥ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è']]);
    exit;
}

require __DIR__ . '/../backend/db.php'; // —Ç–≤–æ–π db.php (–ø—É—Ç–∏ –ø—Ä–æ–≤–µ—Ä—å)

function json_error(array $errors, int $status = 400) {
    http_response_code($status);
    echo json_encode(['ok' => false, 'errors' => $errors], JSON_UNESCAPED_UNICODE);
    exit;
}
function ok_response() {
    echo json_encode(['ok' => true], JSON_UNESCAPED_UNICODE);
    exit;
}

// –ß–∏—Ç–∞–µ–º JSON
$raw = file_get_contents('php://input');
$data = json_decode($raw, true);
if (!is_array($data)) {
    json_error(['common' => '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å'], 400);
}

$username = isset($data['username']) ? trim((string)$data['username']) : '';
$email    = isset($data['email'])    ? trim((string)$data['email'])    : '';
$password = isset($data['password']) ? (string)$data['password']       : '';
$csrf     = isset($data['csrf'])     ? (string)$data['csrf']           : '';

// CSRF double-submit cookie
if (empty($_COOKIE['csrf_token']) || !hash_equals($_COOKIE['csrf_token'], $csrf)) {
    json_error(['common' => '–ò—Å—Ç–µ–∫–ª–∞ —Å–µ—Å—Å–∏—è —Ñ–æ—Ä–º—ã. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.'], 403);
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è
$errors = [];

// Username: 3-30, –∫–∏—Ä/–ª–∞—Ç/—Ü–∏—Ñ—Ä—ã _ . -, –Ω–µ —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã
if ($username === '' || mb_strlen($username) < 3 || mb_strlen($username) > 30) {
    $errors['username'] = '–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 3 –¥–æ 30 —Å–∏–º–≤–æ–ª–æ–≤.';
} else {
    // –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ—Å—Ç–∞–≤
    if (!preg_match('/^[A-Za-z–ê-–Ø–∞-—è–Å—ë0-9._-]{3,30}$/u', $username)) {
        $errors['username'] = '–†–∞–∑—Ä–µ—à–µ–Ω—ã –±—É–∫–≤—ã (–ª–∞—Ç/–∫–∏—Ä), —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª—ã _ . -.';
    } elseif (!preg_match('/[A-Za-z–ê-–Ø–∞-—è–Å—ë0-9]/u', $username)) {
        $errors['username'] = '–ò–º—è –Ω–µ –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.';
    }
}

// Email: –ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ + –Ω–∞–ª–∏—á–∏–µ @ –∏ .
$emailLower = mb_strtolower($email, 'UTF-8');
if ($emailLower === '' || mb_strlen($emailLower) > 254 || strpos($emailLower, '@') === false || strpos($emailLower, '.') === false) {
    $errors['email'] = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email.';
}

// Password: 8-64, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤, –±—É–∫–≤—ã + —Ü–∏—Ñ—Ä—ã
if ($password === '' || mb_strlen($password) < 8 || mb_strlen($password) > 64 || preg_match('/\s/u', $password)) {
    $errors['password'] = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 8 –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤.';
} else {
    if (!preg_match('/[A-Za-z–ê-–Ø–∞-—è–Å—ë]/u', $password) || !preg_match('/[0-9]/', $password)) {
        $errors['password'] = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã.';
    }
}

if ($errors) {
    json_error($errors, 422);
}

// Rate limit (MVP): 5 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ IP / 10 –º–∏–Ω—É—Ç, 3 –Ω–∞ email / 10 –º–∏–Ω—É—Ç
const RATE_SALT = 'change_this_salt_to_random_secret_please';
$ip = $_SERVER['REMOTE_ADDR'] ?? '0.0.0.0';
$ip_hash = hash('sha256', $ip . RATE_SALT);
$email_hash = hash('sha256', $emailLower . RATE_SALT);

// –°–º–æ—Ç—Ä–∏–º –ø–æ–ø—ã—Ç–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –º–∏–Ω—É—Ç
try {
    $stmt = $pdo->prepare("SELECT COUNT(*) AS c FROM registration_attempts WHERE ip_hash = ? AND created_at >= (NOW() - INTERVAL 10 MINUTE)");
    $stmt->execute([$ip_hash]);
    $ipCount = (int)$stmt->fetchColumn();

    if ($ipCount >= 5) {
        // –ó–∞–ø–∏—à–µ–º –Ω–µ—É—Å–ø–µ—à–Ω—É—é –ø–æ–ø—ã—Ç–∫—É
        $pdo->prepare("INSERT INTO registration_attempts (ip_hash, email_hash, success) VALUES (?,?,0)")
            ->execute([$ip_hash, $email_hash]);
        json_error(['common' => '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'], 429);
    }

    $stmt = $pdo->prepare("SELECT COUNT(*) AS c FROM registration_attempts WHERE email_hash = ? AND created_at >= (NOW() - INTERVAL 10 MINUTE)");
    $stmt->execute([$email_hash]);
    $emailCount = (int)$stmt->fetchColumn();

    if ($emailCount >= 3) {
        $pdo->prepare("INSERT INTO registration_attempts (ip_hash, email_hash, success) VALUES (?,?,0)")
            ->execute([$ip_hash, $email_hash]);
        json_error(['common' => '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'], 429);
    }
} catch (Throwable $e) {
    // –ù–µ –≤–∞–ª–∏–º –ø—Ä–æ—Ü–µ—Å—Å ‚Äî –ª–æ–≥–∏–∫–∞ MVP
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email –∏ username
try {
    // email –ø–æ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
    $stmt = $pdo->prepare("SELECT id FROM users WHERE email = ? LIMIT 1");
    $stmt->execute([$emailLower]);
    if ($stmt->fetch()) {
        $pdo->prepare("INSERT INTO registration_attempts (ip_hash, email_hash, success) VALUES (?,?,0)")
            ->execute([$ip_hash, $email_hash]);
        json_error(['email' => '–ü–æ—á—Ç–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞.'], 409);
    }

    $stmt = $pdo->prepare("SELECT id FROM users WHERE username = ? LIMIT 1");
    $stmt->execute([$username]);
    if ($stmt->fetch()) {
        $pdo->prepare("INSERT INTO registration_attempts (ip_hash, email_hash, success) VALUES (?,?,0)")
            ->execute([$ip_hash, $email_hash]);
        json_error(['username' => '–ù–∏–∫ —É–∂–µ –∑–∞–Ω—è—Ç.'], 409);
    }
} catch (Throwable $e) {
    json_error(['common' => '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'], 500);
}

// –í—Å—ë –æ–∫ ‚Äî —Å–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
try {
    // –•–µ—à –ø–∞—Ä–æ–ª—è
    if (defined('PASSWORD_ARGON2ID')) {
        $hash = password_hash($password, PASSWORD_ARGON2ID);
    } else {
        $hash = password_hash($password, PASSWORD_DEFAULT);
    }
    $confirm_token = bin2hex(random_bytes(32));
    $session_token = bin2hex(random_bytes(32));

    $pdo->beginTransaction();
    $stmt = $pdo->prepare("
        INSERT INTO users (
            username, email, password_hash, role,
            email_confirmed, confirm_token, confirm_sent_at, session_token
        ) VALUES (?, ?, ?, 'student', 0, ?, NOW(), ?)
    ");
    $stmt->execute([$username, $emailLower, $hash, $confirm_token, $session_token]);
    $pdo->commit();


    // —É—Å–ø–µ—Ö ‚Äî –∑–∞–ø–∏—Å—å –ø–æ–ø—ã—Ç–∫–∏
    $pdo->prepare("INSERT INTO registration_attempts (ip_hash, email_hash, success) VALUES (?,?,1)")
        ->execute([$ip_hash, $email_hash]);

    // –ö—É–∫–∏ —Å–µ—Å—Å–∏–∏ (–æ–∂–∏–¥–∞–Ω–∏–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏)
    $secure = isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on';
    setcookie('session_token', $session_token, [
        'expires'  => time() + 12 * 3600, // 12 —á–∞—Å–æ–≤
        'path'     => '/',
        'secure'   => $secure,
        'httponly' => true,
        'samesite' => 'Lax',
    ]);

    // –ö–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è UI
    setcookie('welcome_name', $username, [
        'expires'  => time() + 2 * 3600,  // 2 —á–∞—Å–∞
        'path'     => '/',
        'secure'   => $secure,
        'httponly' => false,
        'samesite' => 'Lax',
    ]);

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º ok=true ‚Äî —Ñ—Ä–æ–Ω—Ç —Å–¥–µ–ª–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç
    ok_response();

} catch (Throwable $e) {
    if ($pdo->inTransaction()) { $pdo->rollBack(); }
    json_error(['common' => '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'], 500);
}

--------------------------------------------------------------------------------

–§–∞–π–ª: send_confirm_email.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\backend\send_confirm_email.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /backend/send_confirm_email.php
header("Content-Type: application/json; charset=UTF-8");



// –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF (double-submit cookie)
$input = json_decode(file_get_contents("php://input"), true);
if (!isset($input['csrf'], $_COOKIE['csrf_token']) || $input['csrf'] !== $_COOKIE['csrf_token']) {
    echo json_encode(['ok' => false, 'error' => 'CSRF check failed']);
    exit;
}

// !!! –ù–∞—Å—Ç—Ä–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î —á–µ—Ä–µ–∑ PDO
require_once __DIR__ . "/../db.php"; // –≤ db.php —É —Ç–µ–±—è PDO $pdo

// –ü–æ–ª—É—á–∞–µ–º email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ—Å—Å–∏–∏ –∏–ª–∏ –∫—É–∫–∏ (–∫–∞–∫ —É —Ç–µ–±—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
if (!isset($_COOKIE['session_token'])) {
    echo json_encode(['ok' => false, 'error' => '–ù–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏']);
    exit;
}

$stmt = $pdo->prepare("SELECT id, email, email_confirmed FROM users WHERE session_token = ?");
$stmt->execute([$_COOKIE['session_token']]);
$user = $stmt->fetch(PDO::FETCH_ASSOC);
if (!$user) {
    echo json_encode(['ok' => false, 'error' => '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω']);
    exit;
}
if ($user['email_confirmed']) {
    echo json_encode(['ok' => true, 'already' => true]);
    exit;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
$token = bin2hex(random_bytes(32));
$stmt = $pdo->prepare("UPDATE users SET confirm_token = ?, confirm_sent_at = NOW() WHERE id = ?");
$stmt->execute([$token, $user['id']]);

// –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ —á–µ—Ä–µ–∑ Gmail (PHPMailer)
use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;
require __DIR__ . "/../vendor/autoload.php";

$mail = new PHPMailer(true);

try {
    // !!! –ù–∞—Å—Ç—Ä–æ–π Gmail-–∞–∫–∫–∞—É–Ω—Ç
    $mail->isSMTP();
    $mail->Host = 'smtp.gmail.com';
    $mail->SMTPAuth = true;
    $mail->Username = 'eduproacademynew@gmail.com'; // !!!
    $mail->Password = 'tvmp zvzx vmdg tbjk';    // !!! (–ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Gmail)
    $mail->SMTPSecure = 'tls';
    $mail->Port = 587;

    $mail->setFrom('eduproacademynew@gmail.com', '–û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è'); // !!!
    $mail->addAddress($user['email']);

    $link = "http://localhost:8080/backend/confirm_email.php?token=" . urlencode($token);

    $mail->isHTML(true);
    $mail->Subject = "–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—á—Ç—ã ‚Äî –û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è";
    $mail->Body = "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!<br><br>–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–∞—à–µ–π –ø–æ—á—Ç—ã –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ:<br>
                   <a href='{$link}'>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ—á—Ç—É</a><br><br>
                   –ï—Å–ª–∏ –≤—ã –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å, –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–π—Ç–µ —ç—Ç–æ –ø–∏—Å—å–º–æ.";

    $mail->send();
    echo json_encode(['ok' => true]);
} catch (Exception $e) {
    echo json_encode(['ok' => false, 'error' => '–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' . $mail->ErrorInfo]);
}

--------------------------------------------------------------------------------

–§–∞–π–ª: –¢–ó.txt
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\documents\–¢–ó.txt
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –û–Ω–ª–∞–π–Ω-–∞–∫–∞–¥–µ–º–∏—è

1. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–û–Ω–ª–∞–π–Ω-–∞–∫–∞–¥–µ–º–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã —Å —É–ø–æ—Ä–æ–º –Ω–∞ –≥–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω—è—Ç—å –∑–Ω–∞–Ω–∏—è –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ. –°—Ç–∞—Ä—Ç–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ Python, —Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –≤ —Å–º–µ–∂–Ω—ã–µ —Ç–µ–º—ã –∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.

2. –¶–µ–ª—å –ø—Ä–æ–¥—É–∫—Ç–∞

–û–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—É –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞–≤—ã–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á, –Ω–æ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –∏ —Ç–æ–Ω–∫–æ—Å—Ç–µ–π –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.

3. –§–æ—Ä–º–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è

–û—Å–Ω–æ–≤–Ω–æ–π: —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É—Ä–æ–∫–∏ —Å –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è–º–∏ –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –∫—Ä–∞—Ç–∫–∏–µ –≤–∏–¥–µ–æ—Ä–æ–ª–∏–∫–∏ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–µ–º.

–ö–æ–Ω—Ç—Ä–æ–ª—å –∑–Ω–∞–Ω–∏–π: —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è.

4. –î–∏–∞–ø–∞–∑–æ–Ω –∫—É—Ä—Å–æ–≤

–¢–µ–º–∞—Ç–∏–∫–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ: Python (–±–∞–∑–æ–≤—ã–π –∫—É—Ä—Å —Å —É–≥–ª—É–±–ª–µ–Ω–∏–µ–º).

–ë—É–¥—É—â–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ: –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏, —Å–º–µ–∂–Ω—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.

–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ—Ç 1 –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—è—Ü–µ–≤ (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫—É—Ä—Å–∞ –∏ —Ç–µ–º–ø–∞ –æ–±—É—á–µ–Ω–∏—è).

–£—Ä–æ–≤–µ–Ω—å: –æ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ.

5. –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã

–í—ã–¥–∞—é—Ç—Å—è –ø–æ –∏—Ç–æ–≥–∞–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫—É—Ä—Å–∞.

–ë–µ–∑ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–∏ (–Ω–∞ —Å—Ç–∞—Ä—Ç–µ).

6. –ú–æ–¥–µ–ª—å –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏

–ß–∞—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø (–¥–µ–º–æ-—É—Ä–æ–∫–∏, –≤–≤–æ–¥–Ω—ã–µ –º–æ–¥—É–ª–∏).

–ü–æ–ª–Ω—ã–µ –∫—É—Ä—Å—ã –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã ‚Äî –ø–ª–∞—Ç–Ω–æ.

7. –†–µ—Å—É—Ä—Å—ã –∏ –∫–æ–º–∞–Ω–¥–∞

–ù–∞ —Å—Ç–∞—Ä—Ç–µ: –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥) –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å.

–í –±—É–¥—É—â–µ–º: –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–æ–≤ –∫—É—Ä—Å–æ–≤, –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥–∞, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.

8. –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ –∑–∞–ø—É—Å–∫–∞

–≠—Ç–∞–ø 1. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (2 –Ω–µ–¥–µ–ª–∏)

–ê–Ω–∞–ª–∏–∑ —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏ (–Ω–∞—á–∏–Ω–∞—é—â–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã, —Å—Ç—É–¥–µ–Ω—Ç—ã, –ø–µ—Ä–µ–∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è).

–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤.

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —É—á–µ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –ø–µ—Ä–≤–æ–≥–æ –∫—É—Ä—Å–∞.

–≠—Ç–∞–ø 2. –°–æ–∑–¥–∞–Ω–∏–µ MVP (1 –º–µ—Å—è—Ü)

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–∞–∑–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞ —Å –ª–∏—á–Ω—ã–º –∫–∞–±–∏–Ω–µ—Ç–æ–º.

–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö –º–æ–¥—É–ª–µ–π –∫—É—Ä—Å–∞ Python.

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–Ω–∞–Ω–∏–π.

–≠—Ç–∞–ø 3. –ü–∏–ª–æ—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫ (2 –Ω–µ–¥–µ–ª–∏)

–ó–∞–ø—É—Å–∫ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ø–µ—Ä–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–°–±–æ—Ä –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.

–≠—Ç–∞–ø 4. –î–æ—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ (1 –º–µ—Å—è—Ü)

–í–Ω–µ—Å–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.

–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–ª–∞—Ç–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

–≠—Ç–∞–ø 5. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (3-6 –º–µ—Å—è—Ü–µ–≤)

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ–º –ø–æ Python –∏ —Å–º–µ–∂–Ω—ã–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º.

–ó–∞–ø—É—Å–∫ —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏.

–ü—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã.

9. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å)

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–∞–π—Ç–∞: 0 ‚ÇΩ (—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ) –∏–ª–∏ 50‚Äì100 —Ç—ã—Å. ‚ÇΩ (—Ñ—Ä–∏–ª–∞–Ω—Å).

–•–æ—Å—Ç–∏–Ω–≥ –∏ –¥–æ–º–µ–Ω: ~5 —Ç—ã—Å. ‚ÇΩ –≤ –≥–æ–¥.

–†–µ–∫–ª–∞–º–∞ –Ω–∞ —Å—Ç–∞—Ä—Ç–µ: 15‚Äì30 —Ç—ã—Å. ‚ÇΩ.

–ü—Ä–æ—á–∏–µ —Ä–∞—Å—Ö–æ–¥—ã (–ü–û, –≥—Ä–∞—Ñ–∏–∫–∞): 5‚Äì10 —Ç—ã—Å. ‚ÇΩ.
--------------------------------------------------------------------------------

–§–∞–π–ª: confirm_pending.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\frontend\ru\confirm_pending.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /frontend/confirm_pending.php

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CSRF
function new_csrf_token(): string {
    return bin2hex(random_bytes(32));
}
$csrf = new_csrf_token();
setcookie('csrf_token', $csrf, [
    'expires' => time() + 3600,
    'path' => '/',
    'secure' => isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on',
    'httponly' => false, // double-submit cookie
    'samesite' => 'Lax',
]);

// –ó–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
header("X-Content-Type-Options: nosniff");
header("X-Frame-Options: SAMEORIGIN");
header("Referrer-Policy: strict-origin-when-cross-origin");
header("Content-Security-Policy: default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; base-uri 'self'; form-action 'self';");
?>
<!DOCTYPE html>
<html lang="ru" data-theme="">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—á—Ç—ã ‚Äî –û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è</title>
<style>
    :root { --bg-color:#ffffff; --text-color:#000000; --card-bg:#f0f0f0; --danger:#cc1526; --muted:#6b7280; --primary:#007BFF; }
    [data-theme="dark"] { --bg-color:#121212; --text-color:#ffffff; --card-bg:#1f1f1f; }
    body { margin:0; font-family:Arial, sans-serif; background:var(--bg-color); color:var(--text-color); transition:background-color .3s,color .3s; }
    header { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:var(--card-bg); }
    .container { max-width: 560px; margin: 2rem auto; padding: 0 1rem; }
    .card { background:var(--card-bg); padding:1.25rem; border-radius:8px; text-align:center; }
    h2 { margin:0 0 1rem 0; }
    .btn { margin-top:1rem; padding:.8rem 1rem; border:none; border-radius:6px; cursor:pointer; background:var(--primary); color:white; font-size:15px; }
    .btn:disabled { background:gray; cursor:not-allowed; }
    .msg { margin-top:1rem; font-size:.95rem; }
    .error { margin-top:.5rem; font-size:.9rem; color:var(--danger); display:none; }
</style>
</head>
<body>
<header>
    <h1>–û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è</h1>
    <div class="theme-toggle">
        <label><input type="checkbox" id="themeSwitch"> üåô</label>
    </div>
</header>

<div class="container">
  <div class="card">
    <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ—á—Ç—ã</h2>
    <p>–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–∏—Å—å–º–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ—á—Ç—ã.<br>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—é –ø–æ—á—Ç—É.</p>
    <input type="hidden" id="csrf" value="<?php echo htmlspecialchars($csrf, ENT_QUOTES, 'UTF-8'); ?>" />

    <button id="resendBtn" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ —Å–Ω–æ–≤–∞</button>
    <button id="checkBtn" class="btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</button>

    <div id="statusMsg" class="msg"></div>
    <div id="errorMsg" class="error"></div>
  </div>
</div>

<footer style="background:var(--card-bg); padding:1rem; text-align:center; margin-top:3rem; font-size:.9rem;">
  2025 –û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è.
</footer>

<script>
// ===== –¢–µ–º–∞ (–∫–∞–∫ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏) =====
function setCookie(name, value, days) {
  let expires = "";
  if (days) { const d = new Date(); d.setTime(d.getTime()+days*24*60*60*1000); expires = "; expires="+d.toUTCString(); }
  document.cookie = name+"="+(value||"")+expires+"; path=/";
}
function getCookie(name) {
  const nameEQ = name+"="; const ca = document.cookie.split(';');
  for (let i=0;i<ca.length;i++){ let c=ca[i]; while(c.charAt(0)==' ') c=c.substring(1); if(c.indexOf(nameEQ)==0) return c.substring(nameEQ.length); }
  return null;
}
const themeSwitch = document.getElementById('themeSwitch');
const savedTheme = getCookie("theme");
if (savedTheme) {
  document.documentElement.setAttribute('data-theme', savedTheme);
  themeSwitch.checked = (savedTheme === 'dark');
}
themeSwitch.addEventListener('change', function() {
  const theme = this.checked ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', theme);
  setCookie("theme", theme, 365);
});

// ===== –õ–æ–≥–∏–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è =====
const csrf = document.getElementById('csrf').value;
const resendBtn = document.getElementById('resendBtn');
const checkBtn  = document.getElementById('checkBtn');
const statusMsg = document.getElementById('statusMsg');
const errorMsg  = document.getElementById('errorMsg');

async function sendConfirmEmail() {
  try {
    const res = await fetch('../backend/send_confirm_email.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ csrf }),
      credentials: 'include'
    });
    const data = await res.json();
    if (data.ok) {
      statusMsg.textContent = "–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—á—Ç—É.";
      errorMsg.style.display = "none";
      startResendCooldown();
    } else {
      errorMsg.textContent = data.error || "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞.";
      errorMsg.style.display = "block";
    }
  } catch (err) {
    errorMsg.textContent = "–°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
    errorMsg.style.display = "block";
  }
}

// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –Ω–∞ 3 –º–∏–Ω—É—Ç—ã
function startResendCooldown() {
  let secs = 180;
  resendBtn.disabled = true;
  const timer = setInterval(() => {
    secs--;
    resendBtn.textContent = `–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–Ω–æ–≤–∞ (${secs})`;
    if (secs <= 0) {
      clearInterval(timer);
      resendBtn.disabled = false;
      resendBtn.textContent = "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ —Å–Ω–æ–≤–∞";
    }
  }, 1000);
}

async function checkStatus() {
  try {
    const res = await fetch('../backend/check_confirm_status.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ csrf }),
      credentials: 'include'
    });
    const data = await res.json();
    if (data.confirmed) {
      window.location.href = "/ru/map.php";
    } else {
      statusMsg.textContent = "–ü–æ—á—Ç–∞ –µ—â—ë –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞.";
    }
  } catch (err) {
    errorMsg.textContent = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ.";
    errorMsg.style.display = "block";
  }
}

// –°–æ–±—ã—Ç–∏—è
resendBtn.addEventListener('click', sendConfirmEmail);
checkBtn.addEventListener('click', checkStatus);

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫
setInterval(checkStatus, 15000);

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ä–∞–∑—É —à–ª—ë–º –ø–∏—Å—å–º–æ
sendConfirmEmail();
</script>
</body>
</html>

--------------------------------------------------------------------------------

–§–∞–π–ª: index.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\frontend\ru\index.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è</title>
<style>
    :root {
        --bg-color: #ffffff;
        --text-color: #000000;
        --card-bg: #f0f0f0;
    }
    [data-theme="dark"] {
        --bg-color: #121212;
        --text-color: #ffffff;
        --card-bg: #1f1f1f;
    }
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color 0.3s, color 0.3s;
    }
    header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background-color: var(--card-bg);
    }
    .theme-toggle {
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }
    .container {
        max-width: 1000px;
        margin: auto;
        padding: 1rem;
    }
    .btns {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin: 2rem 0;
    }
    .btn {
        padding: 0.7rem 1.2rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        background-color: #007BFF;
        color: white;
        font-size: 15px;
    }
    .btn:hover {
        background-color: #0056b3;
    }
    .hero {
        text-align: center;
        padding: 2rem 1rem;
    }
    .hero p {
        max-width: 700px;
        margin: auto;
        line-height: 1.5;
    }
    .benefits, .info-blocks, .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin-top: 2rem;
    }
    .card, .info, .stat {
        background: var(--card-bg);
        padding: 1rem;
        border-radius: 8px;
        text-align: center;
    }
    .map-block {
        margin-top: 3rem;
        text-align: center;
    }
    .map-link {
        position: relative;
        display: inline-block;
    }
    .map-link img {
        max-width: 100%;
        border-radius: 8px;
        cursor: pointer;
        display: block;
    }
    .map-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.6);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-weight: bold;
        font-size: 1.1rem;
        text-align: center;
    }
    .stat h3 {
        font-size: 2rem;
        margin: 0.5rem 0;
    }
    footer {
        background-color: var(--card-bg);
        padding: 1rem;
        text-align: center;
        margin-top: 3rem;
        font-size: 0.9rem;
    }
</style>
</head>
<body>

<header>
    <h1>–û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è</h1>
    <div class="theme-toggle">
        <label>
            <input type="checkbox" id="themeSwitch"> üåô
        </label>
    </div>
</header>

<div class="container">
    <section class="hero">
        <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ê–∫–∞–¥–µ–º–∏—é</h2>
        <p>–ù–∞—à–∞ –æ–Ω–ª–∞–π–Ω –∞–∫–∞–¥–µ–º–∏—è ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è, –≥–¥–µ –∫–∞–∂–¥—ã–π —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –∑–Ω–∞–Ω–∏—è, –Ω–æ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏. 
        –ú—ã –æ–±—ä–µ–¥–∏–Ω—è–µ–º –ª—É—á—à–∏–µ –º–µ—Ç–æ–¥–∏–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è, –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –∂–∏–≤–æ–µ –æ–±—â–µ–Ω–∏–µ —Å —ç–∫—Å–ø–µ—Ä—Ç–∞–º–∏, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏ —É–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º.</p>
    </section>

    <div class="btns">
        <a href="#"><button class="btn">–í–æ–π—Ç–∏</button></a>
        <a href="register.php"><button class="btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button></a>
    </div>

    <section class="benefits">
        <div class="card">üìö <strong>–ì–ª—É–±–æ–∫–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞</strong> ‚Äî –∏–∑—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã –∏ —Å–∏—Ç—É–∞—Ü–∏–∏ –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏.</div>
        <div class="card">üõ† <strong>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</strong> ‚Äî –∑–∞–∫—Ä–µ–ø–ª—è–µ–º –∑–Ω–∞–Ω–∏—è —á–µ—Ä–µ–∑ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏.</div>
        <div class="card">üë®‚Äçüè´ <strong>–î–æ—Å—Ç—É–ø –∫ —ç–∫—Å–ø–µ—Ä—Ç–∞–º</strong> ‚Äî –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç.</div>
        <div class="card">‚è≥ <strong>–ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫</strong> ‚Äî —É—á–∏—Ç–µ—Å—å –≤ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è.</div>
        <div class="card">üéì <strong>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</strong> ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏.</div>
        <div class="card">üîÑ <strong>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤</strong> ‚Äî –¥–æ—Å—Ç—É–ø –∫ –∞–∫—Ç—É–∞–ª—å–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º.</div>
    </section>

    <section class="info-blocks">
        <div class="info"><h3>–û –Ω–∞—Å</h3><p>–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å 2020 –≥–æ–¥–∞ –∏ –æ–±—É—á–∏–ª–∏ –±–æ–ª–µ–µ 10 000 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∞–∑–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º.</p></div>
        <div class="info"><h3>–ú–µ—Ç–æ–¥–∏–∫–∞</h3><p>–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –∫—É—Ä—Å—ã, —Å–æ—á–µ—Ç–∞—é—â–∏–µ —Ç–µ–æ—Ä–∏—é –∏ –ø—Ä–∞–∫—Ç–∏–∫—É.</p></div>
        <div class="info"><h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</h3><p>–ù–∞—à–∏ –∫—É—Ä–∞—Ç–æ—Ä—ã –Ω–∞ —Å–≤—è–∑–∏ 24/7, —á—Ç–æ–±—ã –ø–æ–º–æ—á—å –≤ –æ–±—É—á–µ–Ω–∏–∏.</p></div>
    </section>

    <section class="stats">
        <div class="stat"><h3>10 000+</h3><p>–°—Ç—É–¥–µ–Ω—Ç–æ–≤</p></div>
        <div class="stat"><h3>50+</h3><p>–ö—É—Ä—Å–æ–≤</p></div>
        <div class="stat"><h3>95%</h3><p>–î–æ–≤–æ–ª—å–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</p></div>
    </section>

    <section class="map-block">
        <a href="#" class="map-link">
            <img src="img/image.png" alt="–ö–∞—Ä—Ç–∞ –ê–∫–∞–¥–µ–º–∏–∏">
            <span class="map-text">–ü–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Ä—Ç–µ</span>
        </a>
    </section>
</div>

<footer>
    2025 –û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è.
</footer>

<script>
    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "")  + expires + "; path=/";
    }

    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i=0;i < ca.length;i++) {
            let c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }

    const themeSwitch = document.getElementById('themeSwitch');
    const savedTheme = getCookie("theme");

    if (savedTheme) {
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeSwitch.checked = savedTheme === 'dark';
    } else {
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        const defaultTheme = prefersDark ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', defaultTheme);
        setCookie("theme", defaultTheme, 365);
        themeSwitch.checked = prefersDark;
    }

    themeSwitch.addEventListener('change', function() {
        const theme = this.checked ? 'dark' : 'light';
        document.documentElement.setAttribute('data-theme', theme);
        setCookie("theme", theme, 365);
    });
</script>

</body>
</html>

--------------------------------------------------------------------------------

–§–∞–π–ª: register.php
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\frontend\ru\register.php
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
<?php
// /frontend/register.php
// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è CSRF (double-submit cookie)
function new_csrf_token(): string {
    return bin2hex(random_bytes(32));
}
$csrf = new_csrf_token();
// HttpOnly –¥–ª—è CSRF –Ω–µ —Å—Ç–∞–≤–∏–º, —á—Ç–æ–±—ã —Ñ—Ä–æ–Ω—Ç –º–æ–≥ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ç–µ–ª–µ ‚Äî —ç—Ç–æ –∏–º–µ–Ω–Ω–æ double-submit cookie.
setcookie('csrf_token', $csrf, [
    'expires' => time() + 3600,
    'path' => '/',
    'secure' => isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on',
    'httponly' => false,
    'samesite' => 'Lax',
]);
// –ë–∞–∑–æ–≤—ã–µ security-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
header("X-Content-Type-Options: nosniff");
header("X-Frame-Options: SAMEORIGIN");
header("Referrer-Policy: strict-origin-when-cross-origin");
// CSP –æ—Å—Ç–∞–≤–∏–º —É–ø—Ä–æ—â—ë–Ω–Ω–æ–π, —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ–º inline JS –≤ MVP
header("Content-Security-Policy: default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; base-uri 'self'; form-action 'self';");
?>
<!DOCTYPE html>
<html lang="ru" data-theme="">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Äî –û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è</title>
<style>
    :root { --bg-color:#ffffff; --text-color:#000000; --card-bg:#f0f0f0; --danger:#cc1526; --muted:#6b7280; }
    [data-theme="dark"] { --bg-color:#121212; --text-color:#ffffff; --card-bg:#1f1f1f; }
    body { margin:0; font-family:Arial, sans-serif; background:var(--bg-color); color:var(--text-color); transition:background-color .3s,color .3s; }
    header { display:flex; justify-content:space-between; align-items:center; padding:1rem; background:var(--card-bg); }
    .theme-toggle { display:flex; align-items:center; gap:.3rem; }
    .container { max-width: 560px; margin: 2rem auto; padding: 0 1rem; }
    .card { background:var(--card-bg); padding:1.25rem; border-radius:8px; }
    h2 { margin:0 0 1rem 0; }
    .field { margin-bottom:1rem; }
    .label { display:block; margin-bottom:.4rem; font-weight:bold; }
    .input { width:100%; padding:.7rem .8rem; border:1px solid #ccc; border-radius:6px; background:transparent; color:var(--text-color); }
    .hint { margin-top:.35rem; font-size:.9rem; color:var(--muted); }
    .error { margin-top:.35rem; font-size:.9rem; color:var(--danger); display:none; }
    .btn { width:100%; padding:.8rem 1rem; border:none; border-radius:6px; cursor:pointer; background:#007BFF; color:white; font-size:15px; }
    .btn:hover { background:#0056b3; }
    .top-error { color:var(--danger); margin-bottom:1rem; display:none; }
    .success { text-align:center; }
    .back { display:inline-block; margin-top:1rem; color:inherit; text-decoration:none; }
    /* —Ñ–∏–∫—Å —à–∏—Ä–∏–Ω—ã */
    *, *::before, *::after { box-sizing: border-box; }

</style>
</head>
<body>
<header>
    <h1>–û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è</h1>
    <div class="theme-toggle">
        <label><input type="checkbox" id="themeSwitch"> üåô</label>
    </div>
</header>

<div class="container">
  <div class="card">
    <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <div id="topError" class="top-error"></div>

    <form id="regForm" novalidate>
      <input type="hidden" name="csrf" id="csrf" value="<?php echo htmlspecialchars($csrf, ENT_QUOTES, 'UTF-8'); ?>" />

      <div class="field">
        <label class="label" for="username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
        <input class="input" id="username" name="username" type="text"
               placeholder="3‚Äì30 —Å–∏–º–≤–æ–ª–æ–≤: –±—É–∫–≤—ã (–ª–∞—Ç/–∫–∏—Ä), —Ü–∏—Ñ—Ä—ã, _ . -"
               autocomplete="username" inputmode="text" />
        <div id="usernameError" class="error"></div>
      </div>

      <div class="field">
        <label class="label" for="email">Email</label>
        <input class="input" id="email" name="email" type="email"
               placeholder="name@example.com" autocomplete="email" />
        <div id="emailError" class="error"></div>
      </div>

      <div class="field">
        <label class="label" for="password">–ü–∞—Ä–æ–ª—å</label>
        <input class="input" id="password" name="password" type="password"
               placeholder="8‚Äì64 —Å–∏–º–≤–æ–ª–∞, –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤"
               autocomplete="new-password" />
        <div id="passwordError" class="error"></div>
      </div>

      <button class="btn" type="submit" id="submitBtn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </form>

    <a class="back" href="/">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
  </div>
</div>

<footer style="background:var(--card-bg); padding:1rem; text-align:center; margin-top:3rem; font-size:.9rem;">
  2025 –û–Ω–ª–∞–π–Ω –ê–∫–∞–¥–µ–º–∏—è.
</footer>

<script>
// ===== –¢–µ–º–∞ (–∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π) =====
function setCookie(name, value, days) {
  let expires = "";
  if (days) { const d = new Date(); d.setTime(d.getTime()+days*24*60*60*1000); expires = "; expires="+d.toUTCString(); }
  document.cookie = name+"="+(value||"")+expires+"; path=/";
}
function getCookie(name) {
  const nameEQ = name+"="; const ca = document.cookie.split(';');
  for (let i=0;i<ca.length;i++){ let c=ca[i]; while(c.charAt(0)==' ') c=c.substring(1); if(c.indexOf(nameEQ)==0) return c.substring(nameEQ.length); }
  return null;
}
const themeSwitch = document.getElementById('themeSwitch');
const savedTheme = getCookie("theme");
if (savedTheme) {
  document.documentElement.setAttribute('data-theme', savedTheme);
  themeSwitch.checked = (savedTheme === 'dark');
} else {
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const defaultTheme = prefersDark ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', defaultTheme);
  setCookie("theme", defaultTheme, 365);
  themeSwitch.checked = prefersDark;
}
themeSwitch.addEventListener('change', function() {
  const theme = this.checked ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', theme);
  setCookie("theme", theme, 365);
});

// ===== –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è =====
const reUsername = /^[A-Za-z–ê-–Ø–∞-—è–Å—ë0-9._-]{3,30}$/u;
const reUsernameHasAlnum = /[A-Za-z–ê-–Ø–∞-—è–Å—ë0-9]/u; // –Ω–µ —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü-—Å–∏–º–≤–æ–ª—ã
const rePasswordLenSpace = /^[^\s]{8,64}$/u;
const rePasswordHasLetter = /[A-Za-z–ê-–Ø–∞-—è–Å—ë]/u;
const rePasswordHasDigit  = /[0-9]/;

function showError(id, msg) {
  const el = document.getElementById(id);
  el.textContent = msg;
  el.style.display = msg ? 'block' : 'none';
}
function clearAllErrors() {
  showError('topError',''); showError('usernameError',''); showError('emailError',''); showError('passwordError','');
}

document.getElementById('regForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  clearAllErrors();
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;

  const username = document.getElementById('username').value.trim();
  const email    = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const csrf     = document.getElementById('csrf').value;

  let hasError = false;

  // Username
  if (!reUsername.test(username) || !reUsernameHasAlnum.test(username)) {
    showError('usernameError', '–ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã (–ª–∞—Ç/–∫–∏—Ä), —Ü–∏—Ñ—Ä—ã –∏ —Å–∏–º–≤–æ–ª—ã _ . -, –¥–ª–∏–Ω–∞ 3‚Äì30. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—å –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª, –∫—Ä–æ–º–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö.');
    hasError = true;
  }

  // Email: –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ + –Ω–∞–ª–∏—á–∏–µ @ –∏ .
  if (!email || !email.includes('@') || !email.includes('.')) {
    showError('emailError', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email.');
    hasError = true;
  }

  // Password
  if (!rePasswordLenSpace.test(password) || !rePasswordHasLetter.test(password) || !rePasswordHasDigit.test(password)) {
    showError('passwordError', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 8 –¥–æ 64 —Å–∏–º–≤–æ–ª–æ–≤, –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤, —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã.');
    hasError = true;
  }

  if (hasError) { btn.disabled = false; return; }

  try {
    const res = await fetch('/backend/register.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, email, password, csrf }),
      credentials: 'same-origin',
      keepalive: true
    });
    const data = await res.json();

    if (data?.ok) {
      // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—á—Ç—ã
      window.location.href = '/ru/confirm_pending.php';
      return;
    }

    // –û—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞
    if (data?.errors) {
      if (data.errors.username) showError('usernameError', data.errors.username);
      if (data.errors.email)    showError('emailError',    data.errors.email);
      if (data.errors.password) showError('passwordError', data.errors.password);
      if (data.errors.common)   { const t = document.getElementById('topError'); t.textContent = data.errors.common; t.style.display='block'; }
    } else {
      const t = document.getElementById('topError');
      t.textContent = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
      t.style.display = 'block';
    }
  } catch (err) {
    const t = document.getElementById('topError');
    t.textContent = '–°–µ—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.';
    t.style.display = 'block';
  } finally {
    btn.disabled = false;
  }
});
</script>
</body>
</html>

--------------------------------------------------------------------------------

–§–∞–π–ª: composer.json
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\php\composer.json
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
{
  "require": {
    "phpmailer/phpmailer": "^6.8"
  }
}

--------------------------------------------------------------------------------

–§–∞–π–ª: Dockerfile
–ü—É—Ç—å: C:\Users\dench\Desktop\EduPro\php\Dockerfile
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
FROM php:8.2-apache

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ composer
RUN apt-get update && apt-get install -y \
    git unzip zip libzip-dev libonig-dev \
  && docker-php-ext-install pdo pdo_mysql mysqli zip \
  && apt-get clean && rm -rf /var/lib/apt/lists/*

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Composer (–∫–æ–ø–∏—Ä—É–µ–º –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ composer)
COPY --from=composer:2 /usr/bin/composer /usr/bin/composer

# –í–∫–ª—é—á–∞–µ–º mod_rewrite
RUN a2enmod rewrite

WORKDIR /var/www/html

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ composer.json (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ php-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# (–∫–æ–º–º–µ–Ω—Ç—ã: composer.json –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –∫–æ—Ä–Ω–µ php/ –∏–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ; —Å–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ)
COPY composer.json /tmp/composer.json
RUN if [ -f /tmp/composer.json ]; then composer install --no-dev --optimize-autoloader --working-dir=/tmp && mv /tmp/vendor /var/www/html/vendor; fi

# –ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥–µ—Ç —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω —Ç–æ–º–∞–º–∏ –≤ docker-compose

--------------------------------------------------------------------------------

